<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=320">
        <title>Yacc and Lex Playground</title>
        <style>
textarea {
  font-family: monospace;
}

.error {
  color: red;
}

.warning {
  color: orange;
}

.good {
  color: green;
}
        </style>
        <script src="jquery-1.11.2.js"></script>
        <script src="jison.js"></script>
        <script src="yacclex.js"></script>
    </head>
    <body>
        <h1>Yacc and Lex Playground</h1>
        <p>Uses <a href="https://github.com/zaach/jison">Jison</a> parser generator.</p>
        <div>
            <textarea id="grammar" rows="20" cols="80">
%lex
%%

\s+ ;

var                   return 'VAR';
begin                 return 'BEGIN';
end                   return 'END';
integer               return 'INTEGER';
read                  return 'READ';
write                 return 'WRITE';

[a-z][a-z0-9]*        return 'NAME';
[0-9]+               {
                      return 'NUMBER';
}

":="                  return 'ASSIGN';
"."                   return yytext;
":"                   return yytext;
";"                   return yytext;
"+"                   return yytext;
"-"                   return yytext;
"*"                   return yytext;
"/"                   return yytext;
"("                   return yytext;
")"                   return yytext;

<<EOF>>               return 'EOF';
.                     return 'INVALID';

/lex

%start full

%%

full : program EOF  { return process($1); }
     ;

program : block '.'              { $$ = { vars: [], prog: $1 }; }
        | VAR vardecls block '.' { $$ = { vars: $2, prog: $3 }; }
        ;

vardecls : vardecls NAME ':' INTEGER ';' { $$ = $1.concat($2); }
         | NAME ':' INTEGER ';'          { $$ = [$1]; }
         ;

block : BEGIN statements END { $$ = $2; }
      ;

statements : statements ';' statement { $$ = $1.concat($3); }
           | statement { $$ = [$1]; }
           ;

statement :
          | READ '(' NAME ')'  { $$ = { kind: 'read', var: $3 }; }
          | WRITE '(' expr ')' { $$ = { kind: 'write', expr: $3 }; }
          | NAME ASSIGN expr   { $$ = { kind: 'assign', var: $1, expr: $3 }; }
          ;

expr : term '+' term { $$ = { kind: 'add', lhs: $1, rhs: $3 }; }
     | term '-' term { $$ = { kind: 'sub', lhs: $1, rhs: $3 }; }
     | term '*' term { $$ = { kind: 'mul', lhs: $1, rhs: $3 }; }
     | term '/' term { $$ = { kind: 'div', lhs: $1, rhs: $3 }; }
     | term          { $$ = $1; }
     ;

term : NUMBER { $$ = { kind: 'const', val: Number($1) }; }
     | NAME   { $$ = { kind: 'var', val: $1 }; }
     ;

%%

function process(full) {
  console.log(full);
}</textarea>
            <p>
                <button id="generate">Generate Parser</button>
            </p>
            <pre id="generatorFeedback">
            </pre>
        </div>
        <div>
            <textarea id="input">
begin
  write(3);
  a := 2 + 2
end.</textarea>
            <p>
                <button id="parse">Parse</button>
            </p>
        </div>
        <pre id="output">
        </pre>
    </body>
</html>
