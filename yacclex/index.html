<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=320">
        <title>Yacc and Lex Playground</title>
        <style>
textarea {
  font-family: monospace;
}
        </style>
        <script src="jquery-1.11.2.js"></script>
        <script src="jison.js"></script>
        <script>

(function ($) {

var mainparser;

function bnfSyntaxError(e) {
  if (arguments.length < 1) {
    return;
  }
  alert(e);
}

function grammarConflicts(e) {
  if (arguments.length < 1) {
    return;
  }
  alert(e);
}

function execError(e) {
  if (arguments.length < 1) {
    return;
  }
  alert(e);
}

function generate() {
  bnfSyntaxError();
  grammarConflicts();
  var txt = $("#grammar").val();
  var cfg;
  try {
    cfg = bnf.parse(txt);
  } catch (e) {
    bnfSyntaxError(e);
    return;
  }
  var gen = Jison.Generator(cfg, { type: "lalr" });
  if (gen.conflicts) {
    grammarConflicts(gen.conflicts);
  }
  var js = gen.generate();
  eval(js);
  mainparser = parser;
}

function parse() {
  execError();
  generate();
  var txt = $("#input").val();
  var res;
  try {
    res = mainparser.parse(txt);
  } catch (e) {
    execError(e);
  }
  $("#output").text(res);
}

$(document).ready(function () {
    $("#generate").click(generate);
    $("#parse").click(parse);
});

})(jQuery);

        </script>
    </head>
    <body>
        Using <a href="https://github.com/zaach/jison">Jison</a> parser generator project.
        <div>
            <textarea id="grammar" rows="20" cols="80">
%lex
%%

[0-9]                 return 'DIGIT';
<<EOF>>               return 'EOF';
.                     return yytext;

/lex

%start exp

%%

exp : e EOF  { return process($1); }
    ;

e   : e S r  { $$ = { type: 'e', children: [$1, $2, $3] }; }
    | r      { $$ = { type: 'e', children: [$1] }; }
    ;

r   : r M n   { $$ = { type: 'r', children: [$1, $2, $3] }; }
    | n       { $$ = { type: 'r', children: [$1] }; }
    ;

n   : n d  { $$ = { type: 'n', children: [$1, $2] }; }
    | d    { $$ = { type: 'n', children: [$1] }; }
    ;

d   : DIGIT  { $$ = { type: 'd', value: yytext }; }
    ;

S   : '+'  { $$ = { type: '+' }; }
    ;

M   : '*'  { $$ = { type: '*' }; }
    ;

%%

function indent(ind) {
  var res = "";
  for (var i = 0; i < ind; i++) {
    res += " ";
  }
  return res;
}

function drawtree(node, ind) {
  var ENDL = "\n";
  var res = "";
  if (node.type == 'd') {
    res += indent(ind) + node.type + " : " + node.value + ENDL;
  } else if (node.type == '*' || node.type == '+') {
    res += indent(ind) + node.type + ENDL;
  } else {
    res += indent(ind) + node.type + ENDL;
    for (var i = 0; i < node.children.length; i++) {
      res += drawtree(node.children[i], ind + 1);
    }
  }
  return res;
}

function process(node) {
  return drawtree(node, 0);
}

            </textarea>
            <p>
                <button id="generate">Generate Parser</button>
            </p>
        </div>
        <div>
            <textarea id="input">
5+5*2</textarea>
            <p>
                <button id="parse">Parse</button>
            </p>
        </div>
        <pre id = "output">
        </pre>
    </body>
</html>
